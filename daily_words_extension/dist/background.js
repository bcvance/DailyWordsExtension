(()=>{let e,o="http://127.0.0.1:8000",t=`https://${chrome.runtime.id}.chromiumapp.org/`,n=Math.random().toString(36).substring(2,15);chrome.runtime.onMessage.addListener((function(s,r,a){if("authorize"===s.type){console.log("authorization triggered");const o=new URL("https://accounts.google.com/o/oauth2/v2/auth");o.searchParams.set("client_id","271850698689-01761jqfpvaaq33640kohv5drfhbnq52.apps.googleusercontent.com"),o.searchParams.set("response_type","id_token"),o.searchParams.set("redirect_uri",t),o.searchParams.set("scope","openid profile email"),o.searchParams.set("nonce",n),chrome.identity.launchWebAuthFlow({url:o.href,interactive:!0},(o=>{if(o){const t=o.split("#")[1],n=new URLSearchParams(t).get("id_token").split(".")[1].replace("-","+").replace("_","/"),r=JSON.parse(atob(n));e=r,"options"===s.origin&&chrome.runtime.sendMessage({type:"auth_completed"}),console.log("token",r)}}))}else{if("save"===s.type)return console.log("save "+s.word+" "+s.translation),fetch(o+"/api/save",{method:"POST",body:JSON.stringify({word:s.word,translation:s.translation,userInfo:e})}).then((e=>e.json())).then((e=>console.log(e))).catch((e=>console.log(e))),!0;if("delete"===s.type)return console.log("delete "+s.word+" "+s.translation),fetch(o+"/api/delete",{method:"POST",body:JSON.stringify({word:s.word,userInfo:e})}).then((e=>e.json())).then((e=>console.log(e))).catch((e=>console.log(e))),!0;"saveOptions"===s.type&&chrome.storage.sync.get({sendToPhone:!1,sendToEmail:!1,phoneNumber:"",numWords:5},(function(o){return console.log("function executed"),fetch("http://127.0.0.1:8000/api/update",{method:"POST",body:JSON.stringify({userInfo:e,sendToPhone:o.sendToPhone,sendToEmail:o.sendToEmail,phoneNumber:o.phoneNumber,numWords:o.numWords})}).then((e=>{console.log("first then executed"),console.log(e)})).catch((e=>console.log(e))),!0}))}}))})();